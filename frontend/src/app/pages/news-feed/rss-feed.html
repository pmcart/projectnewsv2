<div class="grid grid-cols-3 gap-4">
  <!-- LEFT -->
  <div class="col-span-1 space-y-4">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-sm font-semibold">Google News RSS</h2>

      <div class="flex items-center gap-2">
        <app-new-content-button
          [itemId]="selectedItem()?.guid || null"
          [itemType]="'rss-feed'"
          [itemData]="selectedItem()">
        </app-new-content-button>

        <app-new-video-button
          [itemId]="selectedItem()?.guid || null"
          [itemType]="'rss-feed'"
          [itemData]="selectedItem()">
        </app-new-video-button>

        <button
          type="button"
          (click)="loadFeed()"
          class="text-xs px-2 py-1 rounded-lg bg-slate-800 hover:bg-slate-700 border border-slate-700"
        >
          Refresh
        </button>
      </div>
    </div>

    <!-- Filters -->
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-2 text-[11px]">
      <div class="grid grid-cols-2 gap-2">
        <div>
          <label class="block mb-1 text-slate-400">Country</label>
          <select
            class="w-full bg-slate-900 border border-slate-700 rounded-lg px-2 py-1 text-xs"
            formControlName="country"
          >
            <option value="US">US</option>
            <option value="GB">UK</option>
            <option value="IE">Ireland</option>
            <option value="DE">Germany</option>
            <option value="FR">France</option>
          </select>
        </div>

        <div>
          <label class="block mb-1 text-slate-400">
            Category <span class="text-slate-500">(ignored if topic set)</span>
          </label>
          <select
            class="w-full bg-slate-900 border border-slate-700 rounded-lg px-2 py-1 text-xs"
            formControlName="category"
          >
            <option [ngValue]="null">Top stories</option>
            <option value="world">World</option>
            <option value="nation">Nation</option>
            <option value="business">Business</option>
            <option value="technology">Technology</option>
            <option value="entertainment">Entertainment</option>
            <option value="science">Science</option>
            <option value="sports">Sports</option>
            <option value="health">Health</option>
          </select>
        </div>
      </div>

      <div>
        <label class="block mb-1 text-slate-400">Topic (search)</label>
        <div class="flex gap-2">
          <input
            type="text"
            class="flex-1 bg-slate-900 border border-slate-700 rounded-lg px-2 py-1 text-xs"
            placeholder="e.g. Ukraine, Bitcoin, AI..."
            formControlName="topic"
          />
          <button
            *ngIf="form.value.topic"
            type="button"
            (click)="clearTopic()"
            class="text-[11px] px-2 rounded-lg bg-slate-800 border border-slate-700 hover:bg-slate-700"
          >
            Clear
          </button>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-2 items-end">
        <div class="flex items-center gap-2">
          <label class="text-slate-400">Limit</label>
          <input
            type="number"
            min="1"
            max="100"
            class="w-20 bg-slate-900 border border-slate-700 rounded-lg px-2 py-1 text-xs"
            formControlName="limit"
          />
        </div>

        <!-- NEW: enrich -->
        <!-- <div>
          <label class="block mb-1 text-slate-400">Enrichment</label>
          <select
            class="w-full bg-slate-900 border border-slate-700 rounded-lg px-2 py-1 text-xs"
            formControlName="enrich"
          >
            <option value="none">None (fast)</option>
            <option value="light">Light (OG + JSON-LD)</option>
            <option value="full">Full (heavier)</option>
          </select>
        </div> -->
      </div>

      <div class="flex justify-end">
        <button
          type="submit"
          class="text-xs px-3 py-1 rounded-lg bg-sky-600 hover:bg-sky-500"
        >
          Apply
        </button>
      </div>
    </form>

    <!-- states -->
    <div *ngIf="loading()" class="text-xs text-slate-400 mt-2">Loading RSS feed...</div>
    <div *ngIf="!loading() && error()" class="text-xs text-red-400 mt-2">{{ error() }}</div>

    <div *ngIf="!loading() && !error() && items().length === 0" class="text-xs text-slate-400 mt-2">
      No items found for current filters.
    </div>

    <!-- list -->
    <div *ngIf="!loading() && !error() && items().length > 0" class="space-y-2 mt-2">
      <article
        *ngFor="let item of items(); trackBy: trackByItem"
        (click)="selectItem(item)"
        [class.border-sky-500]="selectedItem() === item"
        class="bg-slate-900/80 border border-slate-800 rounded-xl p-3 cursor-pointer hover:border-sky-400 transition-all"
      >
        <div class="flex items-start justify-between gap-3 mb-1.5">
          <h3 class="text-xs font-semibold line-clamp-2 leading-tight flex-1">
            {{ item.title || 'Untitled article' }}
          </h3>
          <span class="text-[10px] text-slate-500 whitespace-nowrap flex-shrink-0">
            {{ getBestDate(item) | date: 'short' }}
          </span>
        </div>

        <p *ngIf="item.description" class="text-[11px] text-slate-400 line-clamp-2 mb-2 leading-relaxed">
          {{ item.description }}
        </p>

        <div class="flex items-center justify-between gap-2 text-[11px]">
          <div class="flex items-center gap-1.5 text-slate-500 truncate">
            <svg class="w-3 h-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/>
            </svg>
            <span class="truncate">
              {{ item.siteName || item.sourceName || getDisplayDomain(item) || 'Unknown source' }}
            </span>
          </div>
          <span *ngIf="item.section" class="text-[10px] px-2 py-0.5 rounded-full bg-slate-800 text-slate-400 whitespace-nowrap">
            {{ item.section }}
          </span>
        </div>
      </article>
    </div>
  </div>

  <!-- RIGHT -->
  <div class="col-span-2 bg-slate-900/40 rounded-2xl p-6 border border-slate-800">
    <div
      *ngIf="!selectedItem() && !loading() && !error()"
      class="text-sm text-slate-500 h-full flex items-center justify-center text-center"
    >
      <div class="space-y-2">
        <svg class="w-12 h-12 mx-auto text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/>
        </svg>
        <p>Select a headline to view details</p>
      </div>
    </div>

    <ng-container *ngIf="selectedItem() as current">
      <div class="space-y-4">
        <!-- Header -->
        <div>
          <h2 class="text-xl font-bold leading-tight text-slate-100">{{ current.title }}</h2>

          <div class="mt-2 flex items-center gap-2 text-sm text-slate-400">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/>
            </svg>
            <span class="font-medium">
              {{ current.siteName || current.sourceName || getDisplayDomain(current) || 'Unknown source' }}
            </span>
            <span class="text-slate-600">â€¢</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span>{{ getBestDate(current) | date: 'medium' }}</span>
          </div>
        </div>

        <!-- Description -->
        <p *ngIf="current.description" class="text-sm text-slate-300 leading-relaxed">
          {{ current.description }}
        </p>

        <!-- Metadata -->
        <div class="space-y-3 pt-3 border-t border-slate-800">
          <!-- Section -->
          <div *ngIf="current.section" class="flex items-center gap-2">
            <span class="text-xs font-medium text-slate-500 uppercase tracking-wide">Section</span>
            <span class="text-sm px-3 py-1 rounded-full bg-slate-800 text-slate-300 border border-slate-700">
              {{ current.section }}
            </span>
          </div>

          <!-- Authors -->
          <div *ngIf="current.authors?.length" class="flex items-start gap-2">
            <span class="text-xs font-medium text-slate-500 uppercase tracking-wide pt-1">Authors</span>
            <div class="flex flex-wrap gap-2">
              <span *ngFor="let author of current.authors" class="text-sm text-slate-300">
                {{ author }}
              </span>
            </div>
          </div>

          <!-- Keywords -->
          <div *ngIf="current.keywords?.length" class="flex items-start gap-2">
            <span class="text-xs font-medium text-slate-500 uppercase tracking-wide pt-1">Keywords</span>
            <div class="flex flex-wrap gap-1.5">
              <span
                *ngFor="let k of current.keywords"
                class="text-[11px] px-2.5 py-1 rounded-full bg-slate-800/50 text-slate-400 border border-slate-700/50"
              >
                {{ k }}
              </span>
            </div>
          </div>

          <!-- Links -->
          <div class="flex flex-wrap gap-2 pt-2">
            <a
              *ngIf="getBestLink(current)"
              [href]="getBestLink(current)!"
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-sky-600 hover:bg-sky-500 text-white transition-colors"
            >
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
              </svg>
              Read Article
            </a>

            <a
              *ngIf="current.link"
              [href]="current.link"
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 border border-slate-700 transition-colors"
            >
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
              Google News
            </a>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</div>
